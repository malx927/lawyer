{% extends 'rbac/base.html' %}{% load static rbac %}
{% block title %}人员信息{% endblock title %}
{% block css %}
    <style>
        .table tr > td {
            border-top: 0px!important;
            vertical-align: middle!important;
        }
        .btn-user{
            width:70px!important;
        }
    </style>
{% endblock %}
{% block right %}
    <div class="row">
        <h3 class="text-center">人员信息</h3>
    </div>
    <div class="row">
        {% for item in users %}
            <div class="col-md-2 col-sm-3 col-xs-12">
                <div class="panel panel-default mgt">
                    <div class="panel-heading">
                        <h3 class="panel-title text-center">{{ item.post__name }}</h3>
                    </div>
                    <div class="panel-body" style="min-height: 500px;">
                        <p class="text-center">{{ item.post_name }}人数: {{ item.counts }} 人</p>
                        <table class="table table-responsive">
                            {% for user in  item.children %}
                                <tr>
                                    <td class="text-right">姓名:</td>
                                    <td>
                                        <button  class="btn btn-primary btn-sm btn-user" data-toggle="modal" data-target="#myModal" data-uri="{% url 'adm:user-detail' user.id %}">
                                            {{ user.real_name }}
                                        </button>
                                    </td>
                                </tr>
                            {% endfor %}
                        </table>
                    </div>
                </div>
            </div>

        {% endfor %}
    </div>
    <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">人员信息</h4>
                </div>
                <div class="modal-body">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
{#                    <button type="button" class="btn btn-primary" id="sava-edit-btn">确定</button>#}
                </div>
            </div>
        </div>
    </div>
{% endblock right %}

{% block extjs %}
<script>
    $(function () {
        {% if form.success %}
            Swal.fire(
              '用户创建成功',
              '',
              'success'
            )
        {% endif %}
        $('#myModal').on('show.bs.modal', function(event){
            var button = $(event.relatedTarget);
            var uri = button.attr('data-uri');
            $(this).find('.modal-body').load(uri, function (response, status, xhr) {
                if (status == "error") {
                    var msg = "Sorry but there was an error: ";
                    modal.find('.modal-body').html(msg + xhr.status + " " + (typeof xhr === 'string' ? xhr : xhr.responseText || xhr.statusText || 'Unknown error!'));
                }
            });
        })
    })
</script>
{% endblock %}